# 推荐集群结构

```

+------------+  +----------+   +----------+  +-----------+
|  guide     |  |  guide   |   |   match  |  |   team    |
|            |  |          |   |          |  |           |
+-----^------+  +----^-----+   +-----^----+  +-----^-----+
      |              |               |             |
      |              |               |             |
+-----+--------------v---------------+-------------+-----------+
|                                                              |
|                     message center (redis)                   |
|                                                              |
|                                                              |
+------^----------------------^-----------------------^--------+
       |                      |                       |
       |                      |                       |
+------v-------+      +-------v-------+     +---------v--------+
|              |      |               |     |                  |
|   baseapp    |      |    baseapp    |     |      battleapp   |
|              |      |               |     |                  |
+------^-------+      +-------^-------+     +---------^--------+
       |                      |                       |
       |                      |                       |
+------v----------------------v-----------------------v--------+
|                                                              |
|                  gateway (nginx)                             |
|                                                              |
|                                                              |
+--------------------------------------------------------------+

```
特点：所有服务器可以水平扩展，通过消息队列解耦所有服务器，后端服务器可以进行动态负载均衡，通过滚服实现逻辑热更
前端使用nginx作为网关（如果有必要的话，比如需要https或者wss代理），如果不需要可以直接对外开放
baseapp用来处理玩家数据，比如基本数据、背包、宠物、装备等，可以水平扩展
battleapp用来处理战斗逻辑，可以水平扩展
guide工会服,team服（可以放到一起），可以水平扩展，可以动态负载均衡（还未实现）
每玩家在redis中有一个消息队列，用来传送玩家之间的数据交互
每组工会有一个消息队列（比如工会可以分为4096组，分组是为了动态负载均衡），baseapp向工会服发数据就发到这个队列中